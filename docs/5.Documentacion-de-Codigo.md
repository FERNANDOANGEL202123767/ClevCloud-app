# 5. Documentaci√≥n de C√≥digo

## M√≥dulos y Componentes

### API Layer

#### M√≥dulo: `apiClient`

**Ubicaci√≥n**: `/src/api/client.ts`

**Descripci√≥n Funcional**: Cliente HTTP centralizado configurado con Axios para realizar todas las peticiones al backend. Incluye interceptores para logging autom√°tico y manejo de errores.

**Entradas**:

- Variables de entorno: `API_BASE_URL`, `API_TOKEN`

**Salidas**:

- Instancia configurada de Axios

**Dependencias**:

- `axios`
- `@env` (react-native-dotenv)

**Ejemplo de Uso**:

```typescript
import apiClient from '@/api/client';

// GET request
const response = await apiClient.get('/endpoint');

// POST request
const response = await apiClient.post('/endpoint', { data });
```

**Configuraci√≥n**:

```typescript
{
  baseURL: process.env.API_BASE_URL,
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json',
    token: process.env.API_TOKEN
  }
}
```

------

#### M√≥dulo: `projectService`

**Ubicaci√≥n**: `/src/api/services/projectService.ts`

**Descripci√≥n Funcional**: Servicio especializado para operaciones relacionadas con proyectos. Abstrae la comunicaci√≥n con el endpoint de proyectos y realiza transformaci√≥n de datos de API a modelo interno.

**M√©todos**:

##### `getAllProjects()`

**Descripci√≥n**: Obtiene todos los proyectos del t√©cnico desde el backend.

**Par√°metros**: Ninguno

**Retorno**: `Promise<Project[]>` - Array de proyectos mapeados

**Excepciones**:

- Error de red (timeout, sin conexi√≥n)
- Error 401/403 (autenticaci√≥n)
- Error 500 (servidor)

**Transformaciones**:

- `ID_PROYECTO` ‚Üí `id`
- `NOMBRE_PROYECTO` ‚Üí `nombre`
- `PARQUE` ‚Üí `cliente` y `ubicacion`
- `PROGRESO` ‚Üí `progreso` (Number)

**Ejemplo de Uso**:

```typescript
import { projectService } from '@/api/services/projectService';

try {
  const projects = await projectService.getAllProjects();
  console.log(`Cargados ${projects.length} proyectos`);
} catch (error) {
  console.error('Error al cargar proyectos:', error);
}
```

------

### Components Layer

#### Componente: `Badge`

**Ubicaci√≥n**: `/src/components/common/Badge.tsx`

**Descripci√≥n**: Etiqueta visual para mostrar estados con colores sem√°nticos.

**Props**:

```typescript
interface BadgeProps {
  text: string;           // Texto a mostrar
  type?: 'success' | 'warning' | 'error' | 'info';  // Tipo sem√°ntico
}
```

**Comportamiento**:

- `success`: Fondo verde claro, texto verde oscuro
- `warning`: Fondo amarillo claro, texto amarillo oscuro
- `error`: Fondo rojo claro, texto rojo oscuro
- `info`: Fondo azul claro, texto azul oscuro (default)

**Ejemplo de Uso**:

```typescript
<Badge text="Completado" type="success" />
<Badge text="En Proceso" type="warning" />
<Badge text="Cancelado" type="error" />
```

------

#### Componente: `Card`

**Ubicaci√≥n**: `/src/components/common/Card.tsx`

**Descripci√≥n**: Contenedor con elevaci√≥n y bordes redondeados. Puede ser interactivo si se proporciona `onPress`.

**Props**:

```typescript
interface CardProps {
  children: React.ReactNode;  // Contenido del card
  onPress?: () => void;       // Callback al presionar (opcional)
  delay?: number;             // Delay de animaci√≥n (no usado)
}
```

**Ejemplo de Uso**:

```typescript
// Card est√°tico
<Card>
  <Text>Contenido del card</Text>
</Card>

// Card interactivo
<Card onPress={() => navigate('Detail')}>
  <Text>Presiona aqu√≠</Text>
</Card>
```

------

#### Componente: `SearchBar`

**Ubicaci√≥n**: `/src/components/common/SearchBar.tsx`

**Descripci√≥n**: Barra de b√∫squeda con icono y bot√≥n de limpieza.

**Props**:

```typescript
interface SearchBarProps {
  value: string;                    // Valor actual del input
  onChangeText: (text: string) => void;  // Callback al cambiar texto
  placeholder?: string;             // Placeholder (default: 'Buscar proyectos...')
}
```

**Caracter√≠sticas**:

- Icono de b√∫squeda (üîç)
- Bot√≥n de limpieza (‚úï) visible solo cuando hay texto
- Estilo consistente con dise√±o

**Ejemplo de Uso**:

```typescript
const [query, setQuery] = useState('');

<SearchBar 
  value={query} 
  onChangeText={setQuery}
  placeholder="Buscar por nombre..."
/>
```

------

#### Componente: `SkeletonCard`

**Ubicaci√≥n**: `/src/components/common/SkeletonCard.tsx`

**Descripci√≥n**: Placeholder animado que simula la estructura de un ProjectCard durante la carga.

**Props**: Ninguna

**Animaci√≥n**: Efecto shimmer (opacidad pulsante) usando Reanimated.

**Ejemplo de Uso**:

```typescript
{loading && (
  <>
    <SkeletonCard />
    <SkeletonCard />
    <SkeletonCard />
  </>
)}
```

------

#### Componente: `ProjectCard`

**Ubicaci√≥n**: `/src/components/specific/ProjectCard.tsx`

**Descripci√≥n**: Tarjeta especializada para mostrar informaci√≥n resumida de un proyecto.

**Props**:

```typescript
interface ProjectCardProps {
  project: Project;       // Datos del proyecto
  onPress: () => void;    // Callback al presionar
  index: number;          // √çndice en la lista (para animaciones)
}
```

**Informaci√≥n Mostrada**:

- Nombre del proyecto (t√≠tulo)
- Badge de estado
- Cliente (con icono ‚öóÔ∏é)
- T√©cnico asignado (con icono ‚öíÔ∏é)
- Ubicaci√≥n (con icono ‚öò)
- Barra de progreso visual

**L√≥gica de Estado**:

```typescript
// Determina color del badge seg√∫n estado
getStatusType(estado?: string): 'success' | 'warning' | 'error' | 'info'
```

**Ejemplo de Uso**:

```typescript
<ProjectCard 
  project={project}
  onPress={() => navigation.navigate('ProjectDetail', { project })}
  index={0}
/>
```

------

### Screens Layer

#### Pantalla: `HomeScreen`

**Ubicaci√≥n**: `/src/screens/Home/HomeScreen.tsx`

**Descripci√≥n**: Pantalla principal que muestra lista de proyectos con b√∫squeda y pull-to-refresh.

**Estado Local**:

```typescript
const [refreshing, setRefreshing] = useState(false);
```

**Estado Redux**:

```typescript
const { filteredProjects, loading, error, searchQuery } = useSelector(
  (state: RootState) => state.projects
);
```

**Efectos Secundarios**:

```typescript
// Carga inicial de proyectos
useEffect(() => {
  dispatch(fetchProjects());
}, [dispatch]);
```

**Funciones**:

##### `handleRefresh()`

```typescript
/**
 * Recarga los proyectos desde el servidor.
 * Activa indicador de refreshing mientras carga.
 */
const handleRefresh = async () => {
  setRefreshing(true);
  await dispatch(fetchProjects());
  setRefreshing(false);
};
```

##### `handleSearch()`

```typescript
/**
 * Actualiza el query de b√∫squeda en Redux.
 * El filtrado se realiza autom√°ticamente en el slice.
 * @param text - Texto ingresado por el usuario
 */
const handleSearch = (text: string) => {
  dispatch(setSearchQuery(text));
};
```

##### `handleProjectPress()`

```typescript
/**
 * Navega a la pantalla de detalle del proyecto.
 * @param project - Proyecto seleccionado
 */
const handleProjectPress = (project: Project) => {
  navigation.navigate('ProjectDetail', { project });
};
```

**Renderizado Condicional**:

1. **Error**: Muestra ErrorMessage con bot√≥n de retry
2. **Loading inicial**: Muestra skeletons
3. **Lista vac√≠a**: Mensaje "No hay proyectos"
4. **Lista con datos**: FlatList con ProjectCards

------

#### Pantalla: `ProjectDetailScreen`

**Ubicaci√≥n**: `/src/screens/ProjectDetail/ProjectDetailScreen.tsx`

**Descripci√≥n**: Vista detallada de un proyecto individual con toda su informaci√≥n.

**Par√°metros de Navegaci√≥n**:

```typescript
const { project } = route.params;  // Project recibido desde HomeScreen
```

**Secciones Visuales**:

1. **Header con Gradient**:
   - Bot√≥n de regreso
   - Nombre del proyecto
   - Badge de estado
2. **Descripci√≥n** (si existe)
3. **Informaci√≥n General**:
   - Cliente
   - T√©cnico
   - Ubicaci√≥n
   - Contacto
   - Prioridad
4. **Fechas**:
   - Fecha de inicio
   - Fecha de fin
5. **Progreso**:
   - Porcentaje num√©rico
   - Barra de progreso visual
6. **Detalles T√©cnicos**:
   - ID del proyecto

**Funciones**:

##### `getStatusType()`

```typescript
/**
 * Determina el tipo de badge seg√∫n el estado del proyecto.
 * @param estado - Estado del proyecto (opcional)
 * @returns Tipo de badge ('success' | 'warning' | 'error' | 'info')
 */
const getStatusType = (estado?: string): BadgeType => {
  if (!estado) return 'info';
  const lower = estado.toLowerCase();
  if (lower.includes('finalizado') || lower.includes('completado')) 
    return 'success';
  if (lower.includes('proceso') || lower.includes('activo')) 
    return 'warning';
  if (lower.includes('cancelado') || lower.includes('pausado')) 
    return 'error';
  return 'info';
};
```

------

### Store Layer

#### Slice: `projectSlice`

**Ubicaci√≥n**: `/src/store/slices/projectSlice.ts`

**Descripci√≥n**: Gestiona el estado global de proyectos usando Redux Toolkit.

**Estado**:

```typescript
interface ProjectState {
  projects: Project[];          // Datos originales del API
  filteredProjects: Project[];  // Datos filtrados por b√∫squeda
  loading: boolean;             // Indicador de carga
  error: string | null;         // Mensaje de error
  searchQuery: string;          // Query actual de b√∫squeda
}
```

**Actions (S√≠ncronas)**:

##### `setSearchQuery`

```typescript
/**
 * Actualiza el query de b√∫squeda y filtra los proyectos autom√°ticamente.
 * Filtra por: nombre, cliente, estado (case-insensitive).
 * @param state - Estado actual
 * @param action - Acci√≥n con payload: string (query)
 */
setSearchQuery: (state, action: PayloadAction<string>) => {
  state.searchQuery = action.payload;
  if (!action.payload.trim()) {
    state.filteredProjects = state.projects;
  } else {
    const query = action.payload.toLowerCase();
    state.filteredProjects = state.projects.filter(
      project =>
        project.nombre?.toLowerCase().includes(query) ||
        project.cliente?.toLowerCase().includes(query) ||
        project.estado?.toLowerCase().includes(query)
    );
  }
}
```

##### `clearError`

```typescript
/**
 * Limpia el mensaje de error del estado.
 * @param state - Estado actual
 */
clearError: (state) => {
  state.error = null;
}
```

**Thunks (As√≠ncronas)**:

##### `fetchProjects`

```typescript
/**
 * Thunk as√≠ncrono que obtiene proyectos desde el API.
 * Estados:
 * - pending: Activa loading
 * - fulfilled: Guarda proyectos en state
 * - rejected: Guarda mensaje de error
 * @returns Promise<Project[]> - Lista de proyectos
 * @throws Error con mensaje descriptivo
 */
export const fetchProjects = createAsyncThunk(
  'projects/fetchProjects',
  async (_, { rejectWithValue }) => {
    try {
      return await projectService.getAllProjects();
    } catch (error: any) {
      return rejectWithValue(error.message || 'Error al cargar proyectos');
    }
  }
);
```

**Extra Reducers**:

```typescript
builder
  // Estado: Cargando
  .addCase(fetchProjects.pending, state => {
    state.loading = true;
    state.error = null;
  })
  
  // Estado: √âxito
  .addCase(fetchProjects.fulfilled, (state, action) => {
    state.loading = false;
    state.projects = action.payload;
    state.filteredProjects = action.payload;
    state.error = null;
  })
  
  // Estado: Error
  .addCase(fetchProjects.rejected, (state, action) => {
    state.loading = false;
    state.error = action.payload as string;
  });
```

**Ejemplo de Uso**:

```typescript
import { useDispatch, useSelector } from 'react-redux';
import { fetchProjects, setSearchQuery } from '@/store/slices/projectSlice';

// En un componente
const dispatch = useDispatch();
const { filteredProjects, loading, error } = useSelector(
  state => state.projects
);

// Cargar proyectos
useEffect(() => {
  dispatch(fetchProjects());
}, []);

// Buscar
const handleSearch = (text: string) => {
  dispatch(setSearchQuery(text));
};
```

------

### Hooks Layer

#### Hook: `useProjects`

**Ubicaci√≥n**: `/src/hooks/useProjects.ts`

**Descripci√≥n**: Selector especializado de Redux para acceder al estado de proyectos.

**Par√°metros**: Ninguno

**Retorno**:

```typescript
{
  projects: Project[];      // Proyectos filtrados
  loading: boolean;         // Estado de carga
  error: string | null;     // Error si existe
  searchQuery: string;      // Query actual
}
```

**Ejemplo de Uso**:

```typescript
import { useProjects } from '@/hooks/useProjects';

const MyComponent = () => {
  const { projects, loading, error, searchQuery } = useProjects();
  
  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage message={error} />;
  
  return <ProjectList projects={projects} />;
};
```

------

#### Hook: `useLoading`

**Ubicaci√≥n**: `/src/hooks/useLoading.ts`

**Descripci√≥n**: Wrapper para gestionar estados de carga y errores en operaciones as√≠ncronas.

**Retorno**:

```typescript
{
  loading: boolean;                              // Estado de carga
  error: string | null;                          // Mensaje de error
  withLoading: <T>(fn: () => Promise<T>) => Promise<T | null>;
}
```

**Funci√≥n: `withLoading`**

```typescript
/**
 * Ejecuta una funci√≥n as√≠ncrona gestionando autom√°ticamente
 * los estados de loading y error.
 * @param fn - Funci√≥n as√≠ncrona a ejecutar
 * @returns Resultado de la funci√≥n o null si hay error
 */
const withLoading = async <T>(fn: () => Promise<T>): Promise<T | null> => {
  setLoading(true);
  setError(null);
  try {
    return await fn();
  } catch (err) {
    setError((err as Error).message || 'Error desconocido');
    return null;
  } finally {
    setLoading(false);
  }
};
```

**Ejemplo de Uso**:

```typescript
import { useLoading } from '@/hooks/useLoading';

const MyComponent = () => {
  const { loading, error, withLoading } = useLoading();
  
  const loadData = async () => {
    const data = await withLoading(() => fetchData());
    if (data) {
      console.log('Datos cargados:', data);
    }
  };
  
  return (
    <>
      {loading && <LoadingSpinner />}
      {error && <Text>{error}</Text>}
      <Button onPress={loadData} title="Cargar" />
    </>
  );
};
```

------

#### Hook: `useAnimation`

**Ubicaci√≥n**: `/src/hooks/useAnimation.ts`

**Descripci√≥n**: Gestiona animaciones usando Animated API de React Native.

**Retorno**:

```typescript
{
  fadeAnim: Animated.Value;           // Valor animado
  fadeIn: (duration?: number) => void; // Funci√≥n de fade in
}
```

**Funci√≥n: `fadeIn`**

```typescript
/**
 * Anima la opacidad de 0 a 1.
 * @param duration - Duraci√≥n en milisegundos (default: 300)
 */
const fadeIn = (duration: number = 300) => {
  Animated.timing(fadeAnim, {
    toValue: 1,
    duration,
    useNativeDriver: true,
  }).start();
};
```

**Ejemplo de Uso**:

```typescript
import { useAnimation } from '@/hooks/useAnimation';
import { Animated } from 'react-native';

const MyComponent = () => {
  const { fadeAnim, fadeIn } = useAnimation();
  
  useEffect(() => {
    fadeIn(500);
  }, []);
  
  return (
    <Animated.View style={{ opacity: fadeAnim }}>
      <Text>Contenido animado</Text>
    </Animated.View>
  );
};
```

------

### Utils Layer

#### M√≥dulo: `formatters`

**Ubicaci√≥n**: `/src/utils/formatters.ts`

**Funciones**:

##### `formatDate`

```typescript
/**
 * Formatea una fecha ISO a formato legible en espa√±ol.
 * @param dateString - String de fecha ISO (opcional)
 * @returns Fecha formateada o 'N/A' si no v√°lida
 * @example
 * formatDate('2025-10-10') // "10 de octubre de 2025"
 */
export const formatDate = (dateString?: string): string => {
  if (!dateString) return 'N/A';
  try {
    const date = new Date(dateString);
    return date.toLocaleDateString('es-MX', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    });
  } catch {
    return dateString;
  }
};
```

##### `formatPercentage`

```typescript
/**
 * Formatea un n√∫mero como porcentaje redondeado.
 * @param value - Valor num√©rico (opcional)
 * @returns String con formato de porcentaje
 * @example
 * formatPercentage(75.6) // "76%"
 * formatPercentage(undefined) // "0%"
 */
export const formatPercentage = (value?: number): string => {
  if (value === undefined || value === null) return '0%';
  return `${Math.round(value)}%`;
};
```

##### `capitalize`

```typescript
/**
 * Capitaliza la primera letra de un texto.
 * @param text - Texto a capitalizar (opcional)
 * @returns Texto capitalizado o string vac√≠o
 * @example
 * capitalize('hola mundo') // "Hola mundo"
 */
export const capitalize = (text?: string): string => {
  if (!text) return '';
  return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
};
```

------

#### M√≥dulo: `validators`

**Ubicaci√≥n**: `/src/utils/validators.ts`

**Funciones**:

##### `isNotEmpty`

```typescript
/**
 * Valida que un string no est√© vac√≠o.
 * @param value - String a validar (opcional)
 * @returns true si tiene contenido, false si vac√≠o/null/undefined
 * @example
 * isNotEmpty('Hola') // true
 * isNotEmpty('   ') // false
 * isNotEmpty(undefined) // false
 */
export const isNotEmpty = (value?: string): boolean => {
  return !!value && value.trim().length > 0;
};
```

##### `isValidEmail`

```typescript
/**
 * Valida formato de email usando regex.
 * @param email - Email a validar (opcional)
 * @returns true si es email v√°lido, false en caso contrario
 * @example
 * isValidEmail('user@example.com') // true
 * isValidEmail('invalid.email') // false
 */
export const isValidEmail = (email?: string): boolean => {
  if (!email) return false;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};
```

##### `isInRange`

```typescript
/**
 * Valida que un n√∫mero est√© dentro de un rango.
 * @param value - Valor a validar
 * @param min - Valor m√≠nimo (inclusivo)
 * @param max - Valor m√°ximo (inclusivo)
 * @returns true si est√° en rango, false en caso contrario
 * @example
 * isInRange(50, 0, 100) // true
 * isInRange(150, 0, 100) // false
 */
export const isInRange = (value: number, min: number, max: number): boolean => {
  return value >= min && value <= max;
};
```

------

### Types Layer

#### Interfaz: `Project`

**Ubicaci√≥n**: `/src/types/project.types.ts`

**Descripci√≥n**: Define la estructura de un proyecto en el sistema.

```typescript
export interface Project {
  id: string;                  // Identificador √∫nico (requerido)
  nombre?: string;             // Nombre del proyecto
  cliente?: string;            // Cliente/Parque asociado
  estado?: string;             // Estado actual del proyecto
  descripcion?: string;        // Descripci√≥n o servicio
  fecha_inicio?: string;       // Fecha de inicio (ISO)
  fecha_fin?: string;          // Fecha de finalizaci√≥n (ISO)
  ubicacion?: string;          // Ubicaci√≥n f√≠sica
  contacto?: string;           // Contacto del proyecto
  tecnico?: string;            // T√©cnico asignado
  prioridad?: string;          // Nivel de prioridad
  progreso?: number;           // Porcentaje de progreso (0-100)
  supervisor?: string;         // Supervisor del proyecto
  tlider?: string;             // Team leader
  aerogeneradores?: string;    // Lista de aerogeneradores
  numeros_aerogeneradores?: string; // N√∫meros de aerogeneradores
  [key: string]: any;          // Campos adicionales flexibles
}
```

**Campos Obligatorios**: Solo `id`

**Campos Opcionales**: Todos los dem√°s campos son opcionales para manejar respuestas incompletas del API.

------

#### Interfaz: `ApiResponse`

**Ubicaci√≥n**: `/src/types/project.types.ts`

**Descripci√≥n**: Estructura esperada de respuestas del API.

```typescript
export interface ApiResponse {
  success: boolean;            // Indicador de √©xito
  data: Project[];             // Array de proyectos
  message?: string;            // Mensaje opcional (errores)
}
```

------

### Navigation Types

**Ubicaci√≥n**: `/src/types/navigation.types.ts`

#### `RootStackParamList`

```typescript
/**
 * Define las pantallas y sus par√°metros en el Stack Navigator.
 */
export type RootStackParamList = {
  Home: undefined;                    // Sin par√°metros
  ProjectDetail: { project: Project }; // Requiere proyecto
};
```

#### Navigation Props

```typescript
/**
 * Tipo para el prop navigation en HomeScreen.
 */
export type HomeScreenNavigationProp = 
  NativeStackNavigationProp<RootStackParamList, 'Home'>;

/**
 * Tipo para el prop route en ProjectDetailScreen.
 */
export type ProjectDetailScreenRouteProp = 
  RouteProp<RootStackParamList, 'ProjectDetail'>;

/**
 * Tipo para el prop navigation en ProjectDetailScreen.
 */
export type ProjectDetailScreenNavigationProp = 
  NativeStackNavigationProp<RootStackParamList, 'ProjectDetail'>;
```

**Ejemplo de Uso**:

```typescript
import { useNavigation, useRoute } from '@react-navigation/native';
import { 
  HomeScreenNavigationProp,
  ProjectDetailScreenRouteProp 
} from '@/types/navigation.types';

// En HomeScreen
const navigation = useNavigation<HomeScreenNavigationProp>();
navigation.navigate('ProjectDetail', { project });

// En ProjectDetailScreen
const route = useRoute<ProjectDetailScreenRouteProp>();
const { project } = route.params;
```

------

### Config Layer

#### M√≥dulo: `constants`

**Ubicaci√≥n**: `/src/config/constants.ts`

```typescript
/**
 * Nombre de la aplicaci√≥n.
 */
export const APP_NAME = 'ClevCloud';

/**
 * N√∫mero de items por p√°gina en listas paginadas.
 */
export const ITEMS_PER_PAGE = 20;

/**
 * Timeout para peticiones HTTP (milisegundos).
 */
export const API_TIMEOUT = 15000;
```

------

#### M√≥dulo: `theme`

**Ubicaci√≥n**: `/src/config/theme.ts`

**Descripci√≥n**: Re-exporta todos los tokens del sistema de dise√±o para acceso centralizado.

```typescript
// Re-exportaciones
export { SPACING } from '@/styles/spacing';
export { TYPOGRAPHY } from '@/styles/typography';
export { SHADOWS } from '@/styles/shadows';
export { COLORS } from '@/styles/colors';

// Uso en componentes
import { COLORS, SPACING, TYPOGRAPHY, SHADOWS } from '@/config/theme';
```
