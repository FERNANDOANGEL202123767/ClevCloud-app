# 3. Configuración del Entorno

## Requisitos del Sistema

### Software Necesario

#### 1. Node.js y npm

```bash
# Versión requerida
Node.js >= 20.x
npm >= 8.x

# Verificar instalación
node --version
npm --version
```

#### 2. Java Development Kit (JDK)

```bash
# Versión requerida
JDK 17 o superior

# Verificar instalación
java -version
javac -version
```

#### 3. Android Studio

- **Versión**: Arctic Fox (2020.3.1) o superior
- **Componentes necesarios**:
  - Android SDK
  - Android SDK Platform (API 26-35)
  - Android Virtual Device (AVD) para emulador
  - Android SDK Build-Tools
  - Android SDK Command-line Tools

#### 4. Variables de Entorno (Android)

```bash
# Windows
ANDROID_HOME=C:\Users\TU_USUARIO\AppData\Local\Android\Sdk
JAVA_HOME=C:\Program Files\Java\jdk-17

# Path (agregar a PATH)
# Windows
%ANDROID_HOME%\platform-tools
%ANDROID_HOME%\emulator
%ANDROID_HOME%\tools
%ANDROID_HOME%\tools\bin

```

## Instalación de Dependencias

### 1. Clonar el Repositorio

```bash
git clone <URL_DEL_REPOSITORIO>
cd ClevCloud
```

### 2. Instalar Dependencias de Node

```bash
# Usando npm
npm install
```

### 3. Instalar Dependencias de Android

```bash
# Windows
cd android
gradlew clean
gradlew build
```

**Nota**: La primera ejecución descargará todas las dependencias de Gradle (puede tardar 1 hora)

## Configuración de Variables de Entorno

### Archivo `.env`

Crear un archivo `.env` en la raíz del proyecto:

```bash
# .env
API_BASE_URL=https://api.ejemplo.com
API_TOKEN=tu_token_secreto_aqui
```

**Ubicación**: `/ClevCloud/.env`

**⚠️ IMPORTANTE**:

- Este archivo NO debe versionarse en Git (ya está en .gitignore)

### Configuración de Keystore (Android Release)

#### 1. Crear Keystore de Release

```bash
cd android/app
keytool -genkey -v -keystore my-upload-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000
```

**Datos solicitados**:

- Contraseña del keystore: (guardar en lugar seguro)
- Nombre y apellido
- Unidad organizativa
- Organización
- Ciudad/Localidad
- Estado/Provincia
- Código de país

#### 2. Configurar `gradle.properties`

El archivo `android/gradle.properties` ya contiene:

```properties
MYAPP_RELEASE_STORE_FILE=my-upload-key.keystore
MYAPP_RELEASE_KEY_ALIAS=my-key-alias
MYAPP_RELEASE_STORE_PASSWORD=******
MYAPP_RELEASE_KEY_PASSWORD=******
```

**⚠️ SEGURIDAD**:

- Cambiar las contraseñas en producción
- No compartir el archivo gradle.properties con contraseñas reales

## Comandos de Ejecución

### Modo Desarrollo

#### 1. Iniciar Metro Bundler

```bash
# Terminal 1
npm start

# O
npx react-native start
```

#### 2. Ejecutar en Android

```bash
# Terminal 2 (con Metro corriendo)
npm run android

# O directamente
npx react-native run-android
```

**Requisitos**:

- Tener un emulador Android corriendo, O
- Tener un dispositivo físico conectado con USB debugging habilitado

#### 3. Ejecutar con Expo Go (Desarrollo Rápido)

```bash
# Iniciar con Expo
npx expo start
```

Luego escanear el QR con la app Expo Go instalada en tu dispositivo móvil.

### Modo Producción

#### Generar APK de Release

```bash
# Windows
cd android
gradlew assembleRelease
```

**Output**: `android/app/build/outputs/apk/release/app-release.apk`

#### Generar App Bundle (Play Store)

```bash
# Windows
cd android
gradlew bundleRelease
```

**Output**: `android/app/build/outputs/bundle/release/app-release.aab`

### Usando Expo Application Services (EAS)

#### Instalación de EAS CLI

```bash
npm install -g eas-cli
eas login
```

#### Build Preview (APK Interno)

```bash
eas build --profile preview --platform android
```

#### Build Production (App Bundle)

```bash
eas build --profile production --platform android
```

**Nota**: Los builds se realizan en la nube de Expo, no requieren configuración local de Android.
**cuando lo corre en cmd los builds le dará la dirección de los debugs**

## Configuración del IDE

### Android Studio

#### Configuración Recomendada

1. **Preferences > Appearance & Behavior > System Settings > Android SDK**
   - Marcar API Level 26, 28, 33, 35
   - Instalar Google Play Services
2. **Preferences > Build, Execution, Deployment > Build Tools > Gradle**
   - Gradle JDK: JDK 17
3. **AVD Manager**
   - Crear dispositivo virtual: Pixel 6 con API 33 (Android 13)

## Verificación de Instalación

### Script de Verificación

```bash
# Verificar todas las herramientas
npx react-native doctor

# Output esperado
✓ Node.js
✓ npm
✓ Yarn
✓ Android SDK
✓ Android Studio
✓ JDK
✓ Watchman (opcional)
```

### Checklist Manual

- [ ] Node.js >= 20.x instalado
- [ ] JDK 17 instalado y configurado
- [ ] Android Studio instalado con SDK
- [ ] Variables de entorno configuradas (ANDROID_HOME, JAVA_HOME)
- [ ] Dependencias npm instaladas sin errores
- [ ] Archivo .env creado con credenciales
- [ ] Gradle build exitoso
- [ ] Metro bundler inicia sin problemas
- [ ] App compila en emulador/dispositivo

## Solución de Problemas Comunes

### Error: "SDK location not found"

```bash
# Crear android/local.properties
sdk.dir=C:\\Users\\TU_USUARIO\\AppData\\Local\\Android\\Sdk
```

### Error: "Unable to load script"

```bash
# Limpiar caché de Metro
npx react-native start --reset-cache

# Limpiar build de Android
cd android
gradlew clean
```

### Error: "Command not found: react-native"

```bash
# Instalar React Native CLI globalmente
npm install -g react-native-cli

# O usar npx
npx react-native <comando>
```

### Error: "Gradle build failed"

```bash
# Limpiar y reconstruir
cd android
gradlew clean
gradlew build --info

# Si persiste, eliminar caché de Gradle
rmdir /s /q "%USERPROFILE%\.gradle\caches"
```

### Permisos de Android

### Permisos Requeridos (AndroidManifest.xml)

```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

Estos permisos ya están configurados en el proyecto y son necesarios para:

- Realizar llamadas HTTP al API
- Detectar estado de conectividad

## Configuración de Expo Go

Ver documento **migracion_expo_go.md** para configuración detallada de desarrollo con Expo Go.

